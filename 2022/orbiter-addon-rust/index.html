<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><link rel=prev href=https://www.thomasantony.com/2021/msl-apollo-guidance/><link rel=canonical href=https://www.thomasantony.com/2022/orbiter-addon-rust/><link rel="shortcut icon" type=image/x-icon href=https://www.thomasantony.com/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=https://www.thomasantony.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.thomasantony.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.thomasantony.com/favicon-16x16.png><link rel=manifest href=https://www.thomasantony.com/site.webmanifest><link rel=mask-icon href=https://www.thomasantony.com/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Orbiter Addon Development in Rust | Thomas Antony</title><meta name=title content="Orbiter Addon Development in Rust | Thomas Antony"><link rel=stylesheet href=https://www.thomasantony.com/font/iconfont.css><link rel=stylesheet href=https://www.thomasantony.com/css/main.min.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Orbiter Addon Development in Rust"><meta name=twitter:description content="This short article will explore how to create a spacecraft addon for the Orbiter spaceflight simulator in the Rust programming language. I previously took a stab at this back in 2020 with limited success. I was much less knowledgeable about Rust at the time and the tooling around C++ bindings were not as mature then. This post is a companion to this new repository that contains a proof-of-concept for building a spacecraft addon for Orbiter in Rust."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Orbiter Addon Development in Rust","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.thomasantony.com\/2022\/orbiter-addon-rust\/"},"genre":"posts","wordcount":583,"url":"https:\/\/www.thomasantony.com\/2022\/orbiter-addon-rust\/","datePublished":"2022-01-10T23:49:12-06:00","dateModified":"2022-01-10T23:49:12-06:00","description":""}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://www.thomasantony.com/>Thomas Antony</a></div><div class="menu navbar-right"><a class=menu-item href=https://www.thomasantony.com/ title>Home</a>
<a class=menu-item href=https://www.thomasantony.com/posts/ title>Blog</a>
<a class=menu-item href=https://www.thomasantony.com/publications/ title>Publications</a>
<a class=menu-item href=https://www.thomasantony.com/about/ title>About</a>
<a class=menu-item href=https://www.thomasantony.com/pdf/tantony-resume.pdf title>Resume</a>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;</div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;<a href=https://www.thomasantony.com/>Thomas Antony</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=https://www.thomasantony.com/ title>Home</a>
<a class=menu-item href=https://www.thomasantony.com/posts/ title>Blog</a>
<a class=menu-item href=https://www.thomasantony.com/publications/ title>Publications</a>
<a class=menu-item href=https://www.thomasantony.com/about/ title>About</a>
<a class=menu-item href=https://www.thomasantony.com/pdf/tantony-resume.pdf title>Resume</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>Orbiter Addon Development in Rust</h1><div class=post-meta>Written by <a href=https://www.thomasantony.com/ rel=author>Thomas Antony</a>
<span class=post-time>on <time datetime=2022-01-10>10 January 2022</time></span>
in
<i class="iconfont icon-timer"></i>
3 min</div></header><div class=post-content><p>This short article will explore how to create a spacecraft addon for the <a href=http://orbit.medphys.ucl.ac.uk/>Orbiter</a> spaceflight simulator in the <a href=https://rust-lang.org/>Rust</a> programming language. I previously took a stab at this back in 2020 with <a href=https://github.com/thomasantony/RustMFD>limited success</a>. I was much less knowledgeable about Rust at the time and the tooling around C++ bindings were not as mature then. This post is a companion to <a href=https://github.com/thomasantony/orbiter-rs>this new repository</a> that contains a proof-of-concept for building a spacecraft addon for Orbiter in Rust.</p><h2 id=why-rust>Why Rust?</h2><p>Rust is a relatively new high level systems programming language with a focus on safety. Orbiter is written in C++ and therefore its addons are also typically written in C++. Rust development for Orbiter is facilitated using the <a href=https://cxx.rs>cxx</a> crate.</p><h2 id=design>Design</h2><p>The repository in its current form produces a DLL file as its build artifact that can be loaded into Orbiter as an addon module. <del>Anyone wanting to create a Rust addon will clone/fork the repository and build it along with the the Rust code for their addon.</del>(See update below).</p><p>There are a limited number of Orbiter SDK functions currently available as Rust bindings in this prototype.
This will expand in the future to hopefully encompass the majority of the API. The repository includes a demo addon that models NASA&rsquo;s <a href=https://en.wikipedia.org/wiki/Surveyor_program>Surveyor</a> probe. This follows from the C++ tutorial at <a href=https://www.orbiterwiki.org/wiki/Vessel_Tutorial_1>OrbiterWiki</a> and implements retro-thruster staging and differential thrust attitude control.</p><h2 id=developing-custom-spacecraft-addons>Developing custom spacecraft addons</h2><p><em><strong>Update 01/11/2022: This section has been changed to reflect changes to the crate</strong></em>
<del>All the spacecraft-specific code in the repository lives in its own file (<code>src/shuttle_pb.rs</code> for example).</del>
An addon crate implementing a spacecraft should import the <code>orbiter_rs</code> crate. It should then set its crate-type to <code>cdylib</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>package</span>]
<span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;shuttlepb&#34;</span>
<span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
<span style=color:#a6e22e>authors</span> = [<span style=color:#e6db74>&#34;Thomas Antony&#34;</span>]
<span style=color:#a6e22e>edition</span> = <span style=color:#e6db74>&#34;2018&#34;</span>

[<span style=color:#a6e22e>lib</span>]
<span style=color:#a6e22e>crate-type</span> = [<span style=color:#e6db74>&#34;cdylib&#34;</span>]

[<span style=color:#a6e22e>dependencies</span>]
<span style=color:#a6e22e>orbiter_rs</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1&#34;</span>, <span style=color:#a6e22e>path</span> = <span style=color:#e6db74>&#34;/path/to/orbiter-rs&#34;</span> }
</code></pre></div><p>The crate should then have a <code>lib.rs</code> containing a struct that implements the <code>OrbiterVessel</code> trait. It should then use the <code>init_vessel</code> macro as shown below. This macro generates a stub that is links the Rust code to the OrbiterSDK. For example, in <code>lib.rs</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::{
    ODebug, OrbiterVessel, VesselContext, _V, init_vessel, OBJHANDLE
};

<span style=color:#75715e>#[derive(Default, Debug)]</span>
<span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ShuttlePB</span> {
    some_param: <span style=color:#66d9ef>i32</span>
}

<span style=color:#66d9ef>impl</span> OrbiterVessel <span style=color:#66d9ef>for</span> ShuttlePB {
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>set_class_caps</span>(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self, context: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>VesselContext</span>) {
        context.SetSize(<span style=color:#ae81ff>1.0</span>);
        context.SetPMI(_V<span style=color:#f92672>!</span>(<span style=color:#ae81ff>0.50</span>, <span style=color:#ae81ff>0.50</span>, <span style=color:#ae81ff>0.50</span>));
        context.AddMesh(<span style=color:#e6db74>&#34;ShuttlePB&#34;</span>);
    }
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>pre_step</span>(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self, context: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>VesselContext</span>, _sim_t: <span style=color:#66d9ef>f64</span>, _sim_dt: <span style=color:#66d9ef>f64</span>, _mjd: <span style=color:#66d9ef>f64</span>) {
    }
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>consume_buffered_key</span>(
        <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self,
        context: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>VesselContext</span>,
        key: <span style=color:#a6e22e>crate</span>::ffi::DWORD,
        down: <span style=color:#66d9ef>bool</span>,
        kstate: [<span style=color:#66d9ef>u8</span>; <span style=color:#66d9ef>crate</span>::consts::LKEY_COUNT],
    ) -&gt; <span style=color:#66d9ef>i32</span> {
        <span style=color:#ae81ff>0</span>
    }

}

init_vessel<span style=color:#f92672>!</span>(
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>init</span>(_h_vessel: <span style=color:#a6e22e>OBJHANDLE</span>, _flight_model: <span style=color:#66d9ef>i32</span>) -&gt; <span style=color:#a6e22e>ShuttlePB</span>
    {
        ShuttlePB::default()
    }
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>exit</span>() {}
);
</code></pre></div><p>The addon may use any of the wrapped functions currently available. Any other Orbiter SDK functions will require wrappers to be generated for them. An automated tool like <a href=https://github.com/google/autocxx>autocxx</a> may be worth investigating for this purpose.</p><h2 id=building-and-installing>Building and Installing</h2><p>The addon can be built using <code>cargo build</code> assuming that Visual Studio 2019 is available. Other C++ compilers may or may not work. Deploying the addon also requires a config file and any meshes and other dependencies. An example can be seen in <code>Config/Surveyor.cfg</code>. Once you build the addon, the DLL will be available in the <code>target/i686-pc-windows-msvc/debug</code> folder. This will need to be renamed to match whatever module name you haev in the configuration file.</p><h2 id=summary>Summary</h2><p>This proof-of-concept gives a basic framework for building Orbiter addons in Rust. It is not a complete system by any metric and will require significant amounts of work before it can be considered that.</p></div><div class=post-copyright><p class=copyright-item><span>Share:</span>
<span><a href="//twitter.com/share?url=https%3a%2f%2fwww.thomasantony.com%2f2022%2forbiter-addon-rust%2f&text=Orbiter%20Addon%20Development%20in%20Rust&via=thomasantony" target=_blank title="Share on Twitter"><i class="iconfont icon-twitter"></i></a>
<a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.thomasantony.com%2f2022%2forbiter-addon-rust%2f" target=_blank title="Share on Facebook"><i class="iconfont icon-facebook"></i></a>
<a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.thomasantony.com%2f2022%2forbiter-addon-rust%2f&title=Orbiter%20Addon%20Development%20in%20Rust" target=_blank title="Share on LinkedIn"><i class="iconfont icon-linkedin"></i></a></span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>Back</a></span> ·
<span><a href=https://www.thomasantony.com/>Home</a></span></section></div><div class=post-nav><a href=https://www.thomasantony.com/2021/msl-apollo-guidance/ class=prev rel=prev title="Deriving the MSL/Apollo Entry Guidance Algorithm"><i class="iconfont icon-dajiantou"></i>&nbsp;Deriving the MSL/Apollo Entry Guidance Algorithm</a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span class=author itemprop=copyrightHolder><a href=https://www.thomasantony.com/>Thomas Antony</a> |</span>
<span>Crafted with ❤️&nbsp;&nbsp;by <a href=https://github.com/Fastbyte01/KeepIt target=_blank rel="external nofollow noopener noreffer">KeepIt</a> & <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a></span></div></footer><script src=https://www.thomasantony.com/js/vendor_no_gallery.min.js async></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-56045487-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>