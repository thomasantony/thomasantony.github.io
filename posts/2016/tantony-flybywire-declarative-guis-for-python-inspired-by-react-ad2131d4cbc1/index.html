<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My personal website and notes">
    <link rel="stylesheet" href="/normalize.css" />
    <link rel="stylesheet" href="/style.css" media="screen" />
    <link rel="stylesheet" href="/style-dark.css" media="screen and (prefers-color-scheme: dark)" />
    <title>Flybywire — declarative guis for python inspired by react - Thomas Antony</title>

</head>
<body>
  <header>
    <div id="nav-brand-wrapper">
      <a class="sakura-blossom sans" href="/">Thomas Antony</a>
    </div>
    <nav>
      
      [
        
        <a class="sakura-fade" href="https://thomasantony.com/about">about</a>,
        <a class="sakura-fade" href="https://thomasantony.com/posts">posts</a>,
        <a class="sakura-fade" href="https://thomasantony.com/notes">notes</a>,
        <a class="sakura-fade" href="https://thomasantony.com/publications">publications</a>
      ]
      
    </nav>
  </header>
  <section class="main">
  
<section class="post">
<p >
  <h1>flybywire — Declarative GUIs for Python inspired by React</h1>
  <small>
    <em>Posted on <time datetime="2016-09-04T05:26:46.557Z">04 September, 2016</time></em>
  </small>
  <article><p><img src="/images/medium/1__Ql7p4__Wua5eSiZB41oAAlg.png" alt="Source: &lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;http://xkcd.com/970/&quot;&gt;xkcd#970" /> by Randall Monroe
Source: <a rel="noopener" target="_blank" href="http://xkcd.com/970/">xkcd#970</a> by Randall Monroe</p>
<p>Python is amazing. I love the flexibility, the clean and readable syntax and its huge ecosystem of libraries. However, when it comes to making modern GUIs, it comes up sort in many ways.</p>
<p>There are libraries like <em>PyQT</em> and <em>Kivy</em> to create GUIs for your Python application. However, each of them come with their <a rel="noopener" target="_blank" href="https://medium.com/@tryexceptpass/a-python-ate-my-gui-971f2326ce59#.lpb3pnf2d">own problems</a>. Many modern UI solutions like Electron and React-Native looks to the web to avoid the problems of dealing with multiple platforms. After all, the web is one platform that DOES have it’s share of great (and at times awful) UIs.</p>
<p><a rel="noopener" target="_blank" href="https://github.com/thomasantony/flybywire"><em>flybywire</em></a> is my ongoing experiment to develop a declarative UI library, based off some great work by <a rel="noopener" target="_blank" href="https://medium.com/u/138c0eb26be5">Cristian Medina</a>. So, what is <em>flybywire</em> all about? Well, you need a bit of background before I can go into that.</p>
<h4 id="react-es6-and-the-endless-abyss">React, ES6 and the Endless Abyss</h4>
<p><a rel="noopener" target="_blank" href="http://facebook.github.io/react">React</a> caught my interest sometime late last year when I was trying to build a desktop frontend for a Python project using <a rel="noopener" target="_blank" href="http://electron.atom.io">Electron</a>. I was coming back to web development after a gap of nearly six years and my last experience in the field was with jQuery and PHP.</p>
<p>After finishing a basic <a rel="noopener" target="_blank" href="http://reactfordesigners.com/labs/reactjs-introduction-for-people-who-know-just-enough-jquery-to-get-by/">tutorial</a>, I was really excited about the possibilities of React. However, that excitement was a little dulled once I discovered the wonderful world of node-based tools that seemed almost mandatory if you wanted to create anything serious. I found that javascript is no longer the innocent, interpreted language I knew it as. ES6, CoffeeScript, TypeScript, transpilers, <em>webpack</em>, the endless abyss that is <strong>node-packages</strong> … it is easy to get lost just trying to get a hang of all these tools and frameworks.</p>
<p>So where am I going with all this? Well, my (mis?)adventures with React, Redux etc. can be summarized as:</p>
<ol>
<li>React seems to have zeroed in on a really good way of defining UIs without much clutter. I especially loved the concept of one-way binding and views defined as pure functions of state which redraws the whole page when updated.</li>
<li>I found redux to be a great addition to the React ecosystem that provides clean and predictable state management along with some very fancy debugging features.</li>
<li>A Python programmer who wants to use React or Electron still has to navigate through the very confusing tooling (<em>npm</em>, <em>webpack</em>, <em>babel</em> etc.) before they can even start to create anything useful.</li>
<li>I don’t want to deal with Javascript to design my UI.</li>
</ol>
<p>There has to be a way to do all this in Python!</p>
<h4 id="the-magic-of-websockets">The Magic of Websockets</h4>
<p>Last week, I came across this <a rel="noopener" target="_blank" href="https://medium.com/@tryexceptpass/a-python-ate-my-gui-971f2326ce59#.lpb3pnf2d">article</a> which seemed to reflect many of the problems that I had faced when it came to Python GUIs. The article is part of a 3-part (so far) series that ends with the creation of <a rel="noopener" target="_blank" href="http://github.com/tryexceptpass/sofi">Sofi</a> (Cheers <a rel="noopener" target="_blank" href="https://medium.com/u/138c0eb26be5">Cristian</a>!). As described in the article, Sofi is:</p>
<blockquote>
<p>a system that will generate the necessary HTML and JavaScript code typically needed to produce a single-page application and serve it up through WebSockets</p>
</blockquote>
<p>Though it is at a very early stage in its design, Sofi seems to do what it is supposed to. It allows you to design UIs in Python while leveraging web technologies like Bootstrap to render them. One thing I did not like about Sofi was the imperative nature of the UI design which reminded me of jQuery (and maybe a bit of Java AWT). After my experience with React, I wanted something declarative and functional.</p>
<p>So, is it possible to leverage websockets to implement something that keeps the general idea behind Sofi, but is declarative and functional like React?</p>
<h3 id="flybywire">flybywire</h3>
<p><em>flybywire</em> is my ongoing experiment based on Sofi to create a more declarative UI library. It re-renders the page every time the state changes. It uses a virtual-dom system similar to that used by React, to only update those parts of the page that have actually changed. The coding style in <em>flybywire</em> applications was modeled after that of React. The library includes a helper function that allows components to be defined in a syntax inspired by JSX.</p>
<h4 id="usage">Usage</h4>
<p>Below is a really simple demo app that is included with the library:</p>
<p>A simple counter app made using <strong>flybywire</strong></p>
<p>And this is <strong>counter.py.</strong></p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>flybywire.core </span><span style="color:#b48ead;">import </span><span>App  
</span><span style="color:#b48ead;">from </span><span>flybywire.dom </span><span style="color:#b48ead;">import </span><span>h
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">CounterView</span><span>(</span><span style="color:#bf616a;">count</span><span>):  
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;A simple functional stateless component.&quot;&quot;&quot;  
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">h</span><span>(&#39;</span><span style="color:#a3be8c;">h1</span><span>&#39;, </span><span style="color:#bf616a;">str</span><span>(count))
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">CounterApp</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">App</span><span style="color:#eff1f5;">):  
</span><span>    </span><span style="color:#b48ead;">def </span><span>\</span><span style="background-color:#bf616a;color:#2b303b;">_\_init\_\_(self):  </span><span>
</span><span>        &quot;&quot;&quot;</span><span style="color:#a3be8c;">Initialize the application.</span><span>&quot;&quot;&quot;  
</span><span>        </span><span style="color:#96b5b4;">super</span><span>().\</span><span style="background-color:#bf616a;color:#2b303b;">_\_init\_\_()  </span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.set\</span><span style="background-color:#bf616a;color:#2b303b;">_initial\_state(0)</span><span>
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">render</span><span>(</span><span style="color:#bf616a;">self</span><span>):  
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Renders view given application state.&quot;&quot;&quot;  
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">h</span><span>(&#39;</span><span style="color:#a3be8c;">div</span><span>&#39;,  
</span><span>                    \</span><span style="background-color:#bf616a;color:#2b303b;">[CounterView(count=self.state),  </span><span>
</span><span>                     </span><span style="color:#bf616a;">h</span><span>(&#39;</span><span style="color:#a3be8c;">button</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">+</span><span>&#39;, </span><span style="color:#bf616a;">onclick </span><span>= </span><span style="color:#bf616a;">self</span><span>.increment),  
</span><span>                     </span><span style="color:#bf616a;">h</span><span>(&#39;</span><span style="color:#a3be8c;">button</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">-</span><span>&#39;, </span><span style="color:#bf616a;">onclick </span><span>= </span><span style="color:#bf616a;">self</span><span>.decrement)\</span><span style="background-color:#bf616a;color:#2b303b;">]  </span><span>
</span><span>                )
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">increment</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">e</span><span>):  
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Increments counter.&quot;&quot;&quot;  
</span><span>        </span><span style="color:#bf616a;">self</span><span>.set\</span><span style="background-color:#bf616a;color:#2b303b;">_state(self.state + 1)</span><span>
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">decrement</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">e</span><span>):  
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;Decrements counter.&quot;&quot;&quot;  
</span><span>        </span><span style="color:#bf616a;">self</span><span>.set\</span><span style="background-color:#bf616a;color:#2b303b;">_state(self.state - 1)</span><span>
</span><span>
</span><span>app = </span><span style="color:#bf616a;">CounterApp</span><span>()  
</span><span>app.</span><span style="color:#bf616a;">start</span><span>()
</span></code></pre>
<h4 id="how-it-works">How it Works</h4>
<p>The structure of the code above should be very familiar to anyone who has worked with React before. <em>flybywire</em> provides a helper function for building DOM structures. It is also possible to compose the UI out of stateless, functional components (like <strong>CounterView</strong> in the above example). This DOM structure is then converted into JSON format and sent to the browser over websockets using the <a rel="noopener" target="_blank" href="http://www.autobahn.ws/python/">autobahn</a> library. The javascript part of the library parses the virtual-DOM structure out of the JSON data and patches the existing DOM wherever it has changed. Any DOM event callbacks are also setup to be passed back to the Python app over websockets.</p>
<p>Some of the core parts of this library such as the event server and event processor were directly taken from Sofi with a few modifications. Instead of Bootstrap-based widgets, <em>flybywire</em> allows you to define your own components that can be composed to form whatever widget you need.</p>
<p>It is now possible to make some really simple apps using <em>flybywire</em>. However, the library is at a very early stage, given that the First Commit in the repository was only three days ago!</p>
<h4 id="what-doesn-t-work">What doesn’t work</h4>
<p>Here’s some things that are missing and/or acts weird:</p>
<ul>
<li>Some basic manipulations of the DOM elements such as focusing a particular input box or clearing the input box after a certain action is completed are currently not possible. This will probably require putting back some of the command system from Sofi that I had removed when making <em>flybywire</em>. This can also possibly be fixed by moving to a platform like Electron which may give greater control over the rendering process.</li>
<li>The server shuts down as soon as you close the browser window. This is done on purpose as there is currently no way to reset the application state without restarting the server. The shared state also results in weird behavior if you open multiple windows. Once we move to a platform like Electron, <em>flybywire</em> will have hopefully have more fine control over the life cycle of the application.</li>
</ul>
<h4 id="coming-soon"><strong>Coming Soon</strong></h4>
<p>I will probably add a few more features over the weekend, particularly a better Component class for creating stateful components. Any suggestions/comments/ideas and constructive criticism are welcome!</p>
</article>
</p>
</section>


  </section>
  <footer class="sans">
    <a href="https://github.com/thomasantony/thomasantony.github.io-src" target="_blank"> Source code</a>. Built using <a href="https://getzola.org" target="_blank">Zola</a> and <a href="https://github.com/oxalorg/sakura" target="_blank">Sakura</a>.
  </footer>
</body>
</html>
